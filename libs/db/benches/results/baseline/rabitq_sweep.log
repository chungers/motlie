   Compiling motlie-core v0.1.0 (/home/dchung/projects/github.com/chungers/motlie/feature-vector/libs/core)
warning: motlie-core@0.1.0: SIMD: Targeting NEON for aarch64 Linux
warning: function `euclidean_squared` is never used
 --> libs/core/src/distance/scalar.rs:8:8
  |
8 | pub fn euclidean_squared(a: &[f32], b: &[f32]) -> f32 {
  |        ^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: function `cosine` is never used
  --> libs/core/src/distance/scalar.rs:20:8
   |
20 | pub fn cosine(a: &[f32], b: &[f32]) -> f32 {
   |        ^^^^^^

warning: function `dot` is never used
  --> libs/core/src/distance/scalar.rs:43:8
   |
43 | pub fn dot(a: &[f32], b: &[f32]) -> f32 {
   |        ^^^

warning: function `hamming_distance` is never used
  --> libs/core/src/distance/scalar.rs:52:8
   |
52 | pub fn hamming_distance(a: &[u8], b: &[u8]) -> u32 {
   |        ^^^^^^^^^^^^^^^^

warning: function `from_gray_code` is never used
  --> libs/core/src/distance/quantized/scalar.rs:11:4
   |
11 | fn from_gray_code(gray: u8) -> u8 {
   |    ^^^^^^^^^^^^^^

warning: function `dot_1bit` is never used
  --> libs/core/src/distance/quantized/scalar.rs:39:8
   |
39 | pub fn dot_1bit(query: &[f32], code: &[u8]) -> f32 {
   |        ^^^^^^^^

warning: function `dot_2bit_lookup` is never used
  --> libs/core/src/distance/quantized/scalar.rs:68:8
   |
68 | pub fn dot_2bit_lookup(query: &[f32], code: &[u8], values: &[f32; 4]) -> f32 {
   |        ^^^^^^^^^^^^^^^

warning: function `dot_4bit_linear` is never used
   --> libs/core/src/distance/quantized/scalar.rs:102:8
    |
102 | pub fn dot_4bit_linear(query: &[f32], code: &[u8], scale: f32, offset: f32) -> f32 {
    |        ^^^^^^^^^^^^^^^

   Compiling motlie-db v0.1.0 (/home/dchung/projects/github.com/chungers/motlie/feature-vector/libs/db)
warning: `motlie-core` (lib) generated 8 warnings
warning: unused imports: `LaionDataset` and `LaionSubset`
  --> libs/db/src/vector/benchmark/concurrent.rs:53:41
   |
53 | use crate::vector::benchmark::dataset::{LaionDataset, LaionSubset, LAION_EMBEDDING_DIM};
   |                                         ^^^^^^^^^^^^  ^^^^^^^^^^^
   |
   = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: unused import: `crate::vector::benchmark::metrics::compute_recall`
  --> libs/db/src/vector/benchmark/concurrent.rs:54:5
   |
54 | use crate::vector::benchmark::metrics::compute_recall;
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: unused import: `processor::Processor`
   --> libs/db/src/vector/mod.rs:105:16
    |
105 | pub(crate) use processor::Processor;
    |                ^^^^^^^^^^^^^^^^^^^^

warning: unused import: `TEXT`
 --> libs/db/src/fulltext/schema.rs:7:13
  |
7 |     STRING, TEXT,
  |             ^^^^

warning: unused variable: `config`
   --> libs/db/src/graph/reader.rs:530:13
    |
530 |         let config = config.clone();
    |             ^^^^^^ help: if this is intentional, prefix it with an underscore: `_config`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: unused variable: `vec_ids`
   --> libs/db/src/vector/writer.rs:103:9
    |
103 |         vec_ids: &[VecId],
    |         ^^^^^^^ help: if this is intentional, prefix it with an underscore: `_vec_ids`

warning: type `GetVectorDispatch` is more private than the item `vector::query::Query::GetVector::0`
   --> libs/db/src/vector/query.rs:54:15
    |
 54 |     GetVector(GetVectorDispatch),
    |               ^^^^^^^^^^^^^^^^^ field `vector::query::Query::GetVector::0` is reachable at visibility `pub`
    |
note: but type `GetVectorDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:224:1
    |
224 | pub(crate) struct GetVectorDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    = note: `#[warn(private_interfaces)]` on by default

warning: type `GetInternalIdDispatch` is more private than the item `vector::query::Query::GetInternalId::0`
   --> libs/db/src/vector/query.rs:56:19
    |
 56 |     GetInternalId(GetInternalIdDispatch),
    |                   ^^^^^^^^^^^^^^^^^^^^^ field `vector::query::Query::GetInternalId::0` is reachable at visibility `pub`
    |
note: but type `GetInternalIdDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:323:1
    |
323 | pub(crate) struct GetInternalIdDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: type `GetExternalIdDispatch` is more private than the item `vector::query::Query::GetExternalId::0`
   --> libs/db/src/vector/query.rs:58:19
    |
 58 |     GetExternalId(GetExternalIdDispatch),
    |                   ^^^^^^^^^^^^^^^^^^^^^ field `vector::query::Query::GetExternalId::0` is reachable at visibility `pub`
    |
note: but type `GetExternalIdDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:393:1
    |
393 | pub(crate) struct GetExternalIdDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: type `ResolveIdsDispatch` is more private than the item `vector::query::Query::ResolveIds::0`
   --> libs/db/src/vector/query.rs:60:16
    |
 60 |     ResolveIds(ResolveIdsDispatch),
    |                ^^^^^^^^^^^^^^^^^^ field `vector::query::Query::ResolveIds::0` is reachable at visibility `pub`
    |
note: but type `ResolveIdsDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:463:1
    |
463 | pub(crate) struct ResolveIdsDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: type `ListEmbeddingsDispatch` is more private than the item `vector::query::Query::ListEmbeddings::0`
   --> libs/db/src/vector/query.rs:66:20
    |
 66 |     ListEmbeddings(ListEmbeddingsDispatch),
    |                    ^^^^^^^^^^^^^^^^^^^^^^ field `vector::query::Query::ListEmbeddings::0` is reachable at visibility `pub`
    |
note: but type `ListEmbeddingsDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:562:1
    |
562 | pub(crate) struct ListEmbeddingsDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: type `FindEmbeddingsDispatch` is more private than the item `vector::query::Query::FindEmbeddings::0`
   --> libs/db/src/vector/query.rs:68:20
    |
 68 |     FindEmbeddings(FindEmbeddingsDispatch),
    |                    ^^^^^^^^^^^^^^^^^^^^^^ field `vector::query::Query::FindEmbeddings::0` is reachable at visibility `pub`
    |
note: but type `FindEmbeddingsDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:643:1
    |
643 | pub(crate) struct FindEmbeddingsDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: type `SearchKNNDispatch` is more private than the item `vector::query::Query::SearchKNN::0`
   --> libs/db/src/vector/query.rs:74:15
    |
 74 |     SearchKNN(SearchKNNDispatch),
    |               ^^^^^^^^^^^^^^^^^ field `vector::query::Query::SearchKNN::0` is reachable at visibility `pub`
    |
note: but type `SearchKNNDispatch` is only usable at visibility `pub(crate)`
   --> libs/db/src/vector/query.rs:793:1
    |
793 | pub(crate) struct SearchKNNDispatch {
    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: type alias `BlockCacheConfig` is never used
  --> libs/db/src/graph/schema.rs:56:6
   |
56 | type BlockCacheConfig = GraphBlockCacheConfig;
   |      ^^^^^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: function `format_bytes` is never used
   --> libs/db/src/vector/mod.rs:161:4
    |
161 | fn format_bytes(bytes: usize) -> String {
    |    ^^^^^^^^^^^^

warning: function `dimension_mismatch` is never used
  --> libs/db/src/vector/error.rs:11:8
   |
11 | pub fn dimension_mismatch(expected: u32, got: usize) -> anyhow::Error {
   |        ^^^^^^^^^^^^^^^^^^

warning: function `unknown_embedding` is never used
  --> libs/db/src/vector/error.rs:20:8
   |
20 | pub fn unknown_embedding(code: u64) -> anyhow::Error {
   |        ^^^^^^^^^^^^^^^^^

warning: function `embedding_not_registered` is never used
  --> libs/db/src/vector/error.rs:30:8
   |
30 | pub fn embedding_not_registered(model: &str, dim: u32, distance: &str) -> anyhow::Error {
   |        ^^^^^^^^^^^^^^^^^^^^^^^^

warning: methods `persist` and `persist_in_txn` are never used
   --> libs/db/src/vector/id.rs:230:19
    |
 55 | impl IdAllocator {
    | ---------------- methods in this implementation
...
230 |     pub(crate) fn persist(&self, db: &TransactionDB, embedding: EmbeddingCode) -> Result<()> {
    |                   ^^^^^^^
...
243 |     pub(crate) fn persist_in_txn(
    |                   ^^^^^^^^^^^^^^

warning: method `delete_vector` is never used
   --> libs/db/src/vector/processor.rs:534:19
    |
107 | impl Processor {
    | -------------- method in this implementation
...
534 |     pub(crate) fn delete_vector(
    |                   ^^^^^^^^^^^^^

warning: field `timeout` is never read
   --> libs/db/src/vector/query.rs:226:16
    |
224 | pub(crate) struct GetVectorDispatch {
    |                   ----------------- field in this struct
225 |     pub(crate) params: GetVector,
226 |     pub(crate) timeout: Duration,
    |                ^^^^^^^
    |
    = note: `GetVectorDispatch` has a derived impl for the trait `Debug`, but this is intentionally ignored during dead code analysis

warning: field `timeout` is never read
   --> libs/db/src/vector/query.rs:325:16
    |
323 | pub(crate) struct GetInternalIdDispatch {
    |                   --------------------- field in this struct
324 |     pub(crate) params: GetInternalId,
325 |     pub(crate) timeout: Duration,
    |                ^^^^^^^
    |
    = note: `GetInternalIdDispatch` has a derived impl for the trait `Debug`, but this is intentionally ignored during dead code analysis

warning: field `timeout` is never read
   --> libs/db/src/vector/query.rs:395:16
    |
393 | pub(crate) struct GetExternalIdDispatch {
    |                   --------------------- field in this struct
394 |     pub(crate) params: GetExternalId,
395 |     pub(crate) timeout: Duration,
    |                ^^^^^^^
    |
    = note: `GetExternalIdDispatch` has a derived impl for the trait `Debug`, but this is intentionally ignored during dead code analysis

warning: field `timeout` is never read
   --> libs/db/src/vector/query.rs:465:16
    |
463 | pub(crate) struct ResolveIdsDispatch {
    |                   ------------------ field in this struct
464 |     pub(crate) params: ResolveIds,
465 |     pub(crate) timeout: Duration,
    |                ^^^^^^^
    |
    = note: `ResolveIdsDispatch` has a derived impl for the trait `Debug`, but this is intentionally ignored during dead code analysis

warning: field `timeout` is never read
   --> libs/db/src/vector/query.rs:564:16
    |
562 | pub(crate) struct ListEmbeddingsDispatch {
    |                   ---------------------- field in this struct
563 |     pub(crate) params: ListEmbeddings,
564 |     pub(crate) timeout: Duration,
    |                ^^^^^^^
    |
    = note: `ListEmbeddingsDispatch` has a derived impl for the trait `Debug`, but this is intentionally ignored during dead code analysis

warning: field `timeout` is never read
   --> libs/db/src/vector/query.rs:645:16
    |
643 | pub(crate) struct FindEmbeddingsDispatch {
    |                   ---------------------- field in this struct
644 |     pub(crate) params: FindEmbeddings,
645 |     pub(crate) timeout: Duration,
    |                ^^^^^^^
    |
    = note: `FindEmbeddingsDispatch` has a derived impl for the trait `Debug`, but this is intentionally ignored during dead code analysis

warning: struct `EdgeCfValue` is never constructed
   --> libs/db/src/vector/schema.rs:484:19
    |
484 | pub(crate) struct EdgeCfValue(pub(crate) RoaringBitmapBytes);
    |                   ^^^^^^^^^^^

warning: associated functions `key_from_bytes`, `value_to_bytes`, and `value_from_bytes` are never used
   --> libs/db/src/vector/schema.rs:527:12
    |
518 | impl Edges {
    | ---------- associated functions in this implementation
...
527 |     pub fn key_from_bytes(bytes: &[u8]) -> Result<EdgeCfKey> {
    |            ^^^^^^^^^^^^^^
...
538 |     pub fn value_to_bytes(value: &EdgeCfValue) -> Vec<u8> {
    |            ^^^^^^^^^^^^^^
...
543 |     pub fn value_from_bytes(bytes: &[u8]) -> Result<EdgeCfValue> {
    |            ^^^^^^^^^^^^^^^^

warning: variants `Count` and `Config` are never constructed
   --> libs/db/src/vector/schema.rs:745:5
    |
739 | pub(crate) enum GraphMetaField {
    |                 -------------- variants in this enum
...
745 |     Count(u32),
    |     ^^^^^
746 |     /// Serialized HNSW configuration (deprecated - use EmbeddingSpec)
747 |     Config(Vec<u8>),
    |     ^^^^^^
    |
    = note: `GraphMetaField` has derived impls for the traits `Clone` and `Debug`, but these are intentionally ignored during dead code analysis

warning: associated functions `count` and `config` are never used
   --> libs/db/src/vector/schema.rs:782:12
    |
770 | impl GraphMetaCfKey {
    | ------------------- associated functions in this implementation
...
782 |     pub fn count(embedding_code: EmbeddingCode) -> Self {
    |            ^^^^^
...
787 |     pub fn config(embedding_code: EmbeddingCode) -> Self {
    |            ^^^^^^

warning: associated function `key_from_bytes` is never used
   --> libs/db/src/vector/schema.rs:828:12
    |
820 | impl GraphMeta {
    | -------------- associated function in this implementation
...
828 |     pub fn key_from_bytes(bytes: &[u8]) -> Result<GraphMetaCfKey> {
    |            ^^^^^^^^^^^^^^

warning: associated function `key_from_bytes` is never used
   --> libs/db/src/vector/schema.rs:939:12
    |
931 | impl IdForward {
    | -------------- associated function in this implementation
...
939 |     pub fn key_from_bytes(bytes: &[u8]) -> Result<IdForwardCfKey> {
    |            ^^^^^^^^^^^^^^

warning: associated function `key_from_bytes` is never used
    --> libs/db/src/vector/schema.rs:1012:12
     |
1004 | impl IdReverse {
     | -------------- associated function in this implementation
...
1012 |     pub fn key_from_bytes(bytes: &[u8]) -> Result<IdReverseCfKey> {
     |            ^^^^^^^^^^^^^^

warning: associated function `key_from_bytes` is never used
    --> libs/db/src/vector/schema.rs:1120:12
     |
1112 | impl IdAlloc {
     | ------------ associated function in this implementation
...
1120 |     pub fn key_from_bytes(bytes: &[u8]) -> Result<IdAllocCfKey> {
     |            ^^^^^^^^^^^^^^

warning: struct `PendingCfKey` is never constructed
    --> libs/db/src/vector/schema.rs:1173:19
     |
1173 | pub(crate) struct PendingCfKey(
     |                   ^^^^^^^^^^^^

warning: struct `PendingCfValue` is never constructed
    --> libs/db/src/vector/schema.rs:1181:19
     |
1181 | pub(crate) struct PendingCfValue(pub(crate) ());
     |                   ^^^^^^^^^^^^^^

warning: associated functions `key_to_bytes`, `key_from_bytes`, `value_to_bytes`, and `value_from_bytes` are never used
    --> libs/db/src/vector/schema.rs:1203:12
     |
1202 | impl Pending {
     | ------------ associated functions in this implementation
1203 |     pub fn key_to_bytes(key: &PendingCfKey) -> Vec<u8> {
     |            ^^^^^^^^^^^^
...
1211 |     pub fn key_from_bytes(bytes: &[u8]) -> Result<PendingCfKey> {
     |            ^^^^^^^^^^^^^^
...
1224 |     pub fn value_to_bytes(_value: &PendingCfValue) -> Vec<u8> {
     |            ^^^^^^^^^^^^^^
...
1228 |     pub fn value_from_bytes(_bytes: &[u8]) -> Result<PendingCfValue> {
     |            ^^^^^^^^^^^^^^^^

warning: function `spawn_mutation_consumer_with_processor` is never used
   --> libs/db/src/vector/writer.rs:601:15
    |
601 | pub(crate) fn spawn_mutation_consumer_with_processor(
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: struct `SearchResultCollector` is never constructed
   --> libs/db/src/vector/benchmark/concurrent.rs:136:8
    |
136 | struct SearchResultCollector {
    |        ^^^^^^^^^^^^^^^^^^^^^

warning: associated items `new`, `record`, and `into_results` are never used
   --> libs/db/src/vector/benchmark/concurrent.rs:142:8
    |
141 | impl SearchResultCollector {
    | -------------------------- associated items in this implementation
142 |     fn new() -> Self {
    |        ^^^
...
149 |     fn record(&self, query_idx: usize, neighbor_indices: Vec<usize>) {
    |        ^^^^^^
...
155 |     fn into_results(self, num_queries: usize) -> Vec<Vec<usize>> {
    |        ^^^^^^^^^^^^

warning: function `compute_ground_truth_batch` is never used
    --> libs/db/src/vector/benchmark/dataset.rs:1282:4
     |
1282 | fn compute_ground_truth_batch(
     |    ^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: field `ground_truth_full` is never read
  --> libs/db/src/vector/benchmark/sift.rs:46:5
   |
39 | pub struct SiftDataset {
   |            ----------- field in this struct
...
46 |     ground_truth_full: Vec<Vec<i32>>,
   |     ^^^^^^^^^^^^^^^^^
   |
   = note: `SiftDataset` has derived impls for the traits `Clone` and `Debug`, but these are intentionally ignored during dead code analysis

warning: associated function `from_gray_code` is never used
   --> libs/db/src/vector/quantization/rabitq.rs:388:14
    |
 68 | impl RaBitQ {
    | ----------- associated function in this implementation
...
388 |     const fn from_gray_code(gray: u8) -> u8 {
    |              ^^^^^^^^^^^^^^

   Compiling motlie-mcp v0.1.0 (/home/dchung/projects/github.com/chungers/motlie/feature-vector/libs/mcp)
warning: `motlie-db` (lib) generated 43 warnings (run `cargo fix --lib -p motlie-db` to apply 6 suggestions)
   Compiling motlie v0.1.0 (/home/dchung/projects/github.com/chungers/motlie/feature-vector)
    Finished `release` profile [optimized] target(s) in 8.97s
     Running `target/release/bench_vector sweep --dataset laion --data-dir /home/dchung/data/laion --num-vectors 10000 --num-queries 100 --rabitq --bits 2,4 --rerank 10 --ef 200 --k 10 --results-dir libs/db/benches/results/baseline --assert-recall 0.80`
=== Parameter Sweep ===
Dataset: laion
Vectors: 10000, Queries: 100
ef_search: [200]
k: [10]
RaBitQ bits: [2, 4]
Rerank factors: [10]
Loading embeddings from "/home/dchung/data/laion/img_emb_0.npy"...
  NPY v1.0, header: {'descr': '<f2', 'fortran_order': False, 'shape': (1000448, 512), }
  Shape: [1000448, 512], dtype: <f2, loading first 10000 vectors
  Loaded 10000 vectors (512D)
Loading embeddings from "/home/dchung/data/laion/text_emb_0.npy"...
  NPY v1.0, header: {'descr': '<f2', 'fortran_order': False, 'shape': (1000448, 512), }
  Shape: [1000448, 512], dtype: <f2, loading first 10000 vectors
  Loaded 10000 vectors (512D)
Loaded 10000 db vectors, 100 queries, dim=512
Computing ground truth (k=10)...
Database: "/tmp/bench_vector_3252799"
[2m2026-01-17T20:32:26.043454Z[0m [32m INFO[0m [1mready[0m[1m{[0m[3msubsystem[0m[2m=[0m"vector" [3mpath[0m[2m=[0m"/tmp/bench_vector_3252799"[1m}[0m[2m:[0m [2mmotlie_db::rocksdb::storage[0m[2m:[0m [vector] Created block cache [3msubsystem[0m[2m=[0m"vector" [3mcache_mb[0m[2m=[0m256
[2m2026-01-17T20:32:26.218950Z[0m [32m INFO[0m [1mready[0m[1m{[0m[3msubsystem[0m[2m=[0m"vector" [3mpath[0m[2m=[0m"/tmp/bench_vector_3252799"[1m}[0m[2m:[0m [2mmotlie_db::rocksdb::storage[0m[2m:[0m [vector] Pre-warmed cache [3msubsystem[0m[2m=[0m"vector" [3mloaded[0m[2m=[0m0
[2m2026-01-17T20:32:26.218967Z[0m [32m INFO[0m [1mready[0m[1m{[0m[3msubsystem[0m[2m=[0m"vector" [3mpath[0m[2m=[0m"/tmp/bench_vector_3252799"[1m}[0m[2m:[0m [2mmotlie_db::rocksdb::storage[0m[2m:[0m [vector] Ready [3msubsystem[0m[2m=[0m"vector"

Building HNSW index (M=16, ef_construction=200)...
  10000/10000 vectors
Index built in 89.62s (111.6 vec/s)

=== RaBitQ Parameter Sweep (SIMD) ===

--- 2 bits/dim (SIMD) ---
Encoded 10000 vectors in 1.13s (1.36 MB)
ef       rerank   k        Recall     QPS        P50(ms)    P99(ms)   
----------------------------------------------------------------
200      10       10       100.0     % 214.5      4.14       9.93      

--- 4 bits/dim (SIMD) ---
Encoded 10000 vectors in 1.12s (2.64 MB)
ef       rerank   k        Recall     QPS        P50(ms)    P99(ms)   
----------------------------------------------------------------
200      10       10       100.0     % 233.3      4.18       6.08      
RaBitQ results saved to: "libs/db/benches/results/baseline/rabitq_results.csv"

Results saved to "libs/db/benches/results/baseline/rabitq_sweep.csv"

=== Recall Assertion ===
Minimum recall observed: 100.0%
Required threshold: 80.0%
âœ“ Recall assertion PASSED
